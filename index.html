<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å›¾æ–‡ç»„åˆ</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxmon.top/js/vconsole.min.js"></script>
    <script src="https://maxmon.top/visit?code=card"></script>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <style>
        * {
            user-select: none;
        }
        body,
        html {
            margin: 0 auto;
            font-family: fzqy;
            position: relative;
            margin-top: 25px;
        }

        .up-header {
            width: 600px;
            text-align: center;
        }

        .up-content {
            min-height: 200px;
            border: 1px solid #CCCCCC;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #FAFAFA;
            color: #999;
            font-size: 20px;
            text-align: center;
        }

        .up-area {
            position: relative;
            text-align: center;
            border: 2px dashed #ccc;
            margin: 10px 20px 20px 20px;
            width: 200px;
            min-height: 150px;
            line-height: 100px;
            background-color: #fff;
        }

        .list-group {
            margin: 0px auto;
            ;
            max-width: 80%;
            max-height: 80%;
            min-height: 100px;
            padding: 10px;
        }

        img {
            max-width: 100%;
        }

        .btn {}

        .close {
            margin-left: 550px;
            margin-top: -20px;
        }

        .page-header {
            text-align: center;
            margin-top: 10px;
        }

        #cvs {
            margin: auto;
            height: 500px;
            /* border: 2px solid #ccc; */
        }

        /* canvas { letter-pacing: 6px; } */

        @font-face {
            font-family: 'fzqy';
            /* src: url('//cdn.res.webfont.com/webfonts/css/youziku/46855/46855.gif'); */
            /* src: url('./æ–¹æ­£æ¸…åˆ»æœ¬æ‚¦å®‹ç®€ä½“.TTF'); */
            src: url('https://maxmon.oss-cn-shanghai.aliyuncs.com/%E6%96%B9%E6%AD%A3%E6%B8%85%E5%88%BB%E6%9C%AC%E6%82%A6%E5%AE%8B%E7%AE%80%E4%BD%93.TTF')
        }

        .container.upload {
            text-align: center;
        }


        .dragFile {
            margin: auto;
            width: 250px !important;
            padding: 20px 0;
        }

        .dragFile>input {
            margin: 5px 0;
        }

        .list-drag {
            text-align: center;
        }

        .list-group-item {
            margin: auto;
            width: 90%;
        }

        .pic-contrl {
            position: relative;
            display: inline-block;
            width: 300px;
            height: 300px;
            background-color: aquamarine;
            vertical-align: middle;
        }

        .pic-contrl {
            display: none;
        }
        
        .canvas-out {
            display: none;
            width: 80%;
            height: 300px;
            margin-bottom: 10px;
            border: 2px dashed #ccc;
        }

        @media (max-width: 768px) {
            .pc-box {
                display: none !important;
            }
            .pic-contrl {
                display: none;
            }

            .canvas-out {
                /* display: inline-block; */
                /* width: 236px; */
                /* width: auto !important;
                height: 300px !important; */
                max-width: 100%;
            }
            .container.upload {
                margin-top: -30px;
            }
        }
        @media (min-width: 768px) {
            #drag-contrl {
                position: absolute;
                right: 0;
                top: 80px;
                right: -900px;
                left: 0px;
            }
            #reload {
                display: none;
            }
        }

        .drag-tips {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            font-size: 16px;
        }

        .pc-box {
            text-align: center;
        }
        .pc-box .pc-title {
            text-align: center;
            margin-top: 16px;
            margin-bottom: 32px;
        }
        .pc-box .pc-content {
            margin: auto;
            width: 600px;
            box-sizing: border-box;
            padding: 10px;
            text-align: left;
            border: 1px solid #000000;
        }
        .demo-box {
            position: absolute;
            right: 0;
            top: 60px;
            right: 0;
            left: -850px;
        }
        .demo-box p {
            font-weight: bold;
            font-size: 20px;
        }
        .config-bar span {
            display: inline-block;
            width: 26px;
            text-align: center;
        }
        .config-bar span:active {
            opacity: .6;
        }
    </style>
    <script>
        localStorage.cnType = 'name' // cv|name
        if (window.innerWidth < 768) {
            localStorage.cnType = 'cv'
        }
    </script>
</head>

<body>
    <canvas id="img-transer" style="display: none;"></canvas>
    <header id="header" class="page-header">
        <canvas id="cvs" style="display: none;"></canvas>
        <div class="pic-contrl" id="pic-contrl">
        
        </div>
        <!-- å¤´éƒ¨æ˜¾ç¤º -->
        <div class="container upload ">
            <!-- <div class="up-header center-block">
                <h2>æ–‡ä»¶ä¸Šä¼ â€”â€”ä¸¤ç§å½¢å¼</h2>
                <div class="input-group" style="width:600px; display:flex;">
                    <input type="text" class="form-control" placeholder="åœ¨æ­¤å¤„ç²˜è´´å›¾ç‰‡ç½‘å€">
                    <button type="button" class="btn btn-primary">ä¸Šä¼ å›¾ç‰‡</button>
                </div>
            </div> -->
            <!-- æ‹–æ‹½å›¾ç‰‡åˆ°è¿™æ¥ -->
            
            <div class='pc-box'>
                <h2 class="pc-title">
                    æ¬¢è¿ä½¿ç”¨Cardç”Ÿæˆå™¨(â—'â—¡'â—)
                </h2>
                <div class="pc-content">
                    <p>é—®ï¼šæˆ‘èƒ½ç”¨Cardç”Ÿæˆå™¨åšä»€ä¹ˆï¼Ÿ</p>
                    <p>ç­”ï¼šæ‚¨å¯ä»¥é€šè¿‡Cardç”Ÿæˆå™¨è‡ªåŠ¨ç”Ÿæˆå¦‚å·¦å›¾æ‰€ç¤ºçš„Cardï¼Œç”¨äºæ•™å­¦æˆ–å…¶ä»–å±•ç¤ºéœ€è¦ã€‚</p>
                    <p>é—®ï¼šCardç”Ÿæˆå™¨æ€ä¹ˆä½¿ç”¨ï¼Ÿ</p>
                    <p>ç­”ï¼š1.å°†æ‚¨éœ€è¦ç”ŸæˆCardçš„å›¾ç‰‡æ­£ç¡®å‘½åï¼Œå¦‚éœ€ç”Ÿæˆâ€œé‡ç´«ç½—å…°â€Card,å›¾ç‰‡éœ€å‘½åä¸ºâ€œé‡ç´«ç½—å…°.jpgâ€</p>
                    <p>2.ç‚¹å‡»â€œï¼‹â€æˆ–ä½¿ç”¨æ‹–æ‹½å›¾ç‰‡ï¼ŒCardç”Ÿæˆå™¨ä¼šè‡ªåŠ¨æ’ç‰ˆï¼Œå¹¶åœ¨çº¿ç”Ÿæˆè¯¥å›¾ç‰‡å¯¹åº”çš„è‹±æ–‡</p>
                    <p>3.å¦‚æ‚¨å¯¹è‹±æ–‡ç¿»è¯‘æœ‰äº‰è®®ï¼Œå¯ç‚¹å‡»è‹±æ–‡æ‰€åœ¨æ¡†è¿›è¡Œä¿®æ”¹</p>
                    <p>4.å³é”®Cardå¯ä¿å­˜,å¹¶è‡ªåŠ¨å‘½åä¸ºâ€œCard-é‡ç´«ç½—å…°.jpgâ€</p>
                    <p>é—®ï¼šæˆ‘å¯ä»¥ä¸€æ¬¡ç”Ÿæˆå¤šå¼ Cardä¹ˆï¼Ÿ</p>
                    <p>ç­”ï¼šå¯ä»¥çš„ã€‚æ‚¨å¯ä»¥ä¸€æ¬¡ä¸Šä¼ å¤šå¼ ï¼ŒCardç”Ÿæˆå™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”Cardã€‚ç©ºç™½å¤„å³é”®å¯ä¸€æ¬¡ä¿å­˜ã€‚</p>
                </div>
            </div>
            <div class="pc-box">
                <div class="demo-box">
                    <p>Cardç”Ÿæˆç¤ºä¾‹:</p>
                    <img src="img/Violet.png">
                </div>
            </div>
            <div class="col-md-offset-1 up-content dragFile" id="drag-contrl">
                <p class="config-bar">
                    <span onclick="imgRotate(90)">â—”</span>
                    <span onclick="imgMove(0, +5)">â†‘</span>
                    <span onclick="imgMove(-5, 0)">â†’</span>
                    <span onclick="imgMove(0, -5)">â†“</span>
                    <span onclick="imgMove(+5, 0)">â†</span>
                    <span onclick="imgScale(-10)">-</span>
                    <span onclick="imgScale(+10)">+</span>
                </p>
                <div class="up-area" id="up-area">
                    <p class="drag-tips">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œå“Ÿ</p>
                    <input type="file" style="display:none;" id="fileDrag" name="fileDragselect" multiple>
                    <!-- <div class="row"> -->
                    <ul class="list-group clearfix list-drag">
                    </ul>
                    <!-- </div> -->
                </div>
                <input id="cnInput" placeholder="é‡ç´«ç½—å…°" />
                <input id="enInput" placeholder="Violet" />
            </div>
            <input type="file" style="display:none;" id="fileInput" name="fileselect" multiple>
            <!-- <image id="card-bg" style="display: none;"
                src="data:image/png;base64,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AAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAACC2AgAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDACAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAAAhiIwAAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAQxAAAIIgBAEAQAwCAIAYAAEEMAACCGAAABDEAAAhiAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAgCAGAABBDAAAghgAAAQxAAAIYgAAEMQAACCIAQBAEAMAIIiNAAAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAACGIAABDEAAAgiAEAQBADAIAgBgAAQQwAAIIYAAAEMQAA3FoQp2lqCgAAbEhpmkbS1NRkEgAAbEhNTU2RbNmyxSQAANiQtmzZEklra6tJAACwIbW2tkayffv2FQt9fX0vGA8AAOtJvcZta2uLzGeffVZ9/PHHlyw0NjZ+PT8//4ixAQCwXjQ1Nf1rbm7uz7XHxsbGImlvb49cLrfk5IWFhez4+Pg9xgYAwHowMTFx99zc3KbaY7lcLgqFQiRJkkRXV9fya1p27949bHQAAKwHu3bt+iQiWmqPdXV1RZIkP/4wR7FYjOXvIy6VSg/09/fvMD4AANayY8eOPVEqlR6oPZamaRSLxYiIyFSr1epiFA8ODi6/frparT5ojAAArFWZTOZsLHs63N3dHUNDQ0uDeHZ2NlpbW2N2dnZJEDc0NJTL5fLDRgkAwFqTpulkpVJJa4O4ubk5pqamorm5OSLixy0TiwsDAwPL79FSqVTSNE0njRMAgLUewxER/f39P8fwkiCOiOjs7Iz9+/fXjeJMJnN2cHDwCaMFAGA1GxwcfCKTyZytF8OvvvpqvPTSS0vO/3nLxKJyuRwvvvhijIyM1Lv/dD6fP/fxxx//ta2t7d/GDQDAajExMXH3rl27PvnpH+halq/v3LkzPvrooxUvk0iWn5imaRw/fjyeeeaZep/TUiqVnioUCl9ms9mvDh8+/LzRAwDwRzp8+PDz2Wz2q0Kh8GWpVHqqXgw/++yzcfz48RUxHFHnCfGiSqUSvb298dZbb/3a50/7CgAAWAVabrawf//+OHr0aDQ0NNRdv2kQL/rwww+jt7c3Ll++bMwAAKwZmzdvjv7+/ti7d++vnpf81o06OztjcnIyuru76z5iBgCA1SRN0+ju7o7JycnfjOGIW3hCXGtmZiYGBgbivffei4sXL5o2AACrxtatW6Orqyt6enoil8vd8nW3FcSLbty4EadPn45Tp07FF198EWfOnImZmZmYm5uLSqXi2wAA4HfT0NAQmzZtilwuF9u2bYvt27fHk08+GYVCIZIkue37/WcASkM/5gA4T5wAAAAASUVORK5CYII=">
            </image> -->
            <image id="card-bg" style="display: none;" src="./img/card-bg-3.png"></image>
        </div>
        <text id="reload">å¼ºåˆ¶åˆ·æ–°é¡µé¢</text>
        <br/>
        <div class="pc-box" id="success-tips" style="display:none">
            <h3 class="pc-tips-01">å·²ä¸ºæ‚¨è‡ªåŠ¨ç”Ÿæˆ<span id="pc-img-count"></span>å¼ Card</h3>
            <p class="pc-tips-02">åœ¨ç©ºç™½å¤„å³é”®å¯ä¸€é”®ä¿å­˜ğŸ˜Š</p>
        </div>
        <image src="" class="canvas-out" id="canvas-out" onerror="this.src='./img/white-point.png'"></image>
    </header>

    <script type="text/javascript">
        const xhr = new XMLHttpRequest()
        function reloadPage() {
            console.log('reload')
            window.location.href = window.location.href.replace(/\?.*/g, '') + "?timestamp=" + new Date().getTime() + '&random=' + Math.random();
            console.log(window.location.href)
        }
        window.onload = function () {
            document.getElementById('reload').onclick = reloadPage;
        }
        let cardBgImg = document.getElementById("card-bg");
        var Point = function (x, y) {
            return { x: x, y: y };
        };
        //  width="708" height="1015" 
        // let _x = 708;
        // let _y = 651;
        // let _yy = 1015;

        // let fontSize1 = 80;
        // let fontSize2 = 65;
        let biggerSize = 3;
        let _x = 708 * biggerSize;
        let _y = 651 * biggerSize;
        let _yy = 1015 * biggerSize;

        let fontSize1 = 80 * biggerSize;
        let fontSize2 = 65 * biggerSize;
        document.getElementById('cvs').width = _x;
        document.getElementById('cvs').height = _yy;

        let font1Top = fontSize1 * 2 + _y;
        let font2Top = font1Top + fontSize2 * 1.45;
        let font1Height = fontSize1 * 1.3;
        let font2Height = fontSize2 * 1.3;

        //ç‚¹å‡»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶
        $('#up-area').click(() => {
            $('#fileInput').click();
        })
        $('#fileInput').change((event) => {
            var files = event.target.files;
            window.tarIdx = files.length - 1;
            appendFile(files);
        })

        //æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶ åœ¨é¡µé¢è¿›è¡Œé¢„è§ˆ ä¸Šä¼ formç”¨åˆ°ajax
        const dragbox = document.querySelector('.dragFile');
        dragbox.addEventListener('dragover', function (e) {
            e.preventDefault(); // å¿…é¡»é˜»æ­¢é»˜è®¤äº‹ä»¶
        }, false);
        dragbox.addEventListener('drop', function (e) {
            e.preventDefault(); // é˜»æ­¢é»˜è®¤äº‹ä»¶
            var files = e.dataTransfer.files; //è·å–æ–‡ä»¶
            appendFile(files)
            // code
        }, false);
        let x, y, w, h, tw, th, _xd, _yd, tarImg;
        window.inImgList = window.inImgList || [];
        function appendFile(files) {
            window.ctxList = [];
            window.imgList = [];
            window.inImgList = [];
            window.configList = [];
            console.log('files', files)
            for (let idx = 0; idx < files.length; idx++) {
                const file = files[idx];
                window.inImgList[idx] = file;
                makeImg(idx);
            }
            files = []
        }
        function imgMove(newLDRate, newTDRate) {
            let idx = window.tarIdx;
            let lDRate = window.configList[idx].lDRate || 0;
            let tDRate = window.configList[idx].tDRate || 0;
            lDRate += newLDRate;
            tDRate += newTDRate;
            window.configList[idx].lDRate = lDRate;
            window.configList[idx].tDRate = tDRate;
            lazyMakeImg(idx, {onlyChangeImg: true});
        }
        function imgRotate(newDegreeD) {
            let idx = window.tarIdx;
            let degreeD = window.configList[idx].degreeD || 0;
            degreeD += newDegreeD;
            window.configList[idx].degreeD = degreeD;
            lazyMakeImg(idx, {onlyChangeImg: true});
        }
        function imgScale(newSizeDRate) {
            let idx = window.tarIdx;
            let sizeRate = window.configList[idx].sizeRate || 100;
            sizeRate += newSizeDRate;
            window.configList[idx].sizeRate = sizeRate;
            lazyMakeImg(idx, {onlyChangeImg: true});
        }
        function lazyMakeImg(...args) {
            clearTimeout(window.lazyTimer);
            window.lazyTimer = setTimeout(()=>{
                makeImg(...args);
            }, 500)
        }
        function mixImg() {
            console.log('mixImg');
            let imgCount = window.imgList.length;
            let imgW = 100;
            let imgH = 100;
            let onloadedCount = 0;
            let imgBox = [];
            for (let i = 0; i < imgCount; i++) {
                const img = document.createElement('img');
                img.src = window.imgList[i];
                img.onload = function(ev) {
                    if (i == 0) {
                        imgW = img.width;
                        imgH = img.height;
                    }
                    imgBox[i] = img;
                    if (++onloadedCount == imgCount) {
                        console.log('onloaded');
                        const cvs = document.createElement('canvas');
                        let imgWCount = imgCount < 4 ? imgCount : 4;
                        let imgHCount = Math.ceil(imgCount / 4);
                        cvs.width = imgW * imgWCount * 1.12;
                        cvs.height = imgH * imgHCount * 1.02;
                        const ctx = cvs.getContext('2d');
                        for (let j = 0; j < imgCount; j++) {
                            const _img = imgBox[j];
                            ctx.drawImage(_img, 0, 0, _img.width, _img.height, (j % 4) * imgW * 1.12 + 0.06 * imgW, (j/4|0) * imgH * 1.02  + 0.01 * imgH, imgW, imgH);
                        }
                        let _url = cvs.toDataURL("image/png");
                        var image = document.getElementById('canvas-out')
                        image.src = _url;
                        image.style.display = 'inline-block';
                        image.style.width = (imgWCount * 1.12) * 231 + 'px';
                        image.style.height = 'auto';// (imgHCount * 1.02 - 0.02) * 330 + 'px';

                        if (window.innerWidth < 768) {
                            if (imgCount == 1) {
                                image.style.width = parseInt(image.style.width) / 1.5 + 'px';
                            } else if (imgCount < 3) {
                                image.style.width = parseInt(image.style.width) / 2 + 'px';
                            }
                        }
                        
                        document.getElementById('pc-img-count').innerText = imgCount;
                        document.getElementById('success-tips').style.display = 'block';
                    }
                }
            }
        }
        function imgOnload(img) {
            console.log(count);
        }
        function makeImg(idx, config={}) {
            console.log('idx', idx)
            let file = window.inImgList[idx];
            let url = window.URL.createObjectURL(file);
            if (!config.onlyChangeImg) {
                let listName='.list-drag'
                if (!window.inImgList[idx]) {
                    console.log('no in img list')
                    mixImg();
                    return;
                };
                    let liStr = `
                <li class="list-group-item">
                <div>
                    <img src="${url}" id="topImg" alt="æ–‡ä»¶" />
                </div>
                </li>
            `;
                $(listName).html('')
                $(listName).append(liStr);
            }
            var img = document.createElement("img");
            img.src = url;
            img.onload = function () {
                console.log('load')
                console.log(img)
                w = img.naturalWidth;
                h = img.naturalHeight;
                if (!w || !h) return;
                if (w / h > _x / _y) {
                    let d = (w - h * _x / _y) / 2;
                    x = d;
                    tw = w - 2 * d;
                    y = 0;
                    th = h;
                } else {
                    let d = (h - w * _y / _x) / 2;
                    x = 0;
                    tw = w;
                    y = d;
                    th = h - 2 * d;
                }
                /// æŒ‰è¾“å…¥ ç®—è¾“å‡º
                _x = tw;
                _y = th;
                _yy = _y / 651 * 1015;

                fontSize1 = _y / 651 * 80;
                fontSize2 = _y / 651 * 65;
                let canvas = document.createElement('canvas');
                let ctx = canvas.getContext('2d');
                let _url = getBase64(img, ctx)
                document.getElementById('cvs').width = _x;
                document.getElementById('cvs').height = _yy;
                canvas.width = _x;
                canvas.height = _yy;

                font1Top = fontSize1 * 2 + _y;
                font2Top = font1Top + fontSize2 * 1.45;
                font1Height = fontSize1 * 1.3;
                font2Height = fontSize2 * 1.3;

                window.configList = window.configList || [];
                if (!window.configList[idx]) {
                    window.configList[idx] = {
                        _x,
                        _y,
                        _yy,
                        fontSize1,
                        fontSize2,
                        font1Top,
                        font2Top,
                        font1Height,
                        font2Height
                    }
                }

                tarImg = img;
                
                window.ctxList = window.ctxList || [];
                window.ctxList[idx] = ctx;
                // ç»™ä¸ªç™½è‰²èƒŒæ™¯
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, _x, _yy)
                // console.log(x, y, tw, th)
                let lDRate = window.configList[idx].lDRate || 0;
                let tDRate = window.configList[idx].tDRate || 0;
                let degreeD = window.configList[idx].degreeD || 0;
                let sizeRate = window.configList[idx].sizeRate || 100;
                console.log('-------------------')
                console.log(img, x + (lDRate/100 * tw)|0, y + (tDRate/100 * th)|0, tw, th, 0, 0, _x, _y, x, y)
                console.log('-------------------')
                ctx.translate(_x/2,_y/2);
                ctx.rotate(degreeD*Math.PI/180);
                ctx.drawImage(img, x + (lDRate/100 * tw)|0, y + (tDRate/100 * th)|0, tw, th, -_x/2 * sizeRate/ 100, -_y/2 * sizeRate/ 100, _x * sizeRate/ 100, _y * sizeRate/ 100);
                ctx.rotate(-degreeD*Math.PI/180);
                ctx.translate(-_x/2,-_y/2);
                // console.log(img, x, y, tw, th)
                
                
                addCardBg(ctx, idx)
                convertCanvasToImage(ctx.canvas, idx)

                if (config.onlyChangeImg) {
                    showCnText(idx, window.configList[idx]['cn'])
                    showEnText(idx, window.configList[idx]['en'])
                    mixImg()
                    return;
                }
                // let _url = canvas.toDataURL("image/png");
                // changeImg(file, (_url)=>{
                //     // send2(_url,(result)=>{
                //     //     console.log(result)
                //     // })
                // });
                // console.log(_url)
                _url = _url.substr(22); // ç”¨_url = _url.replace(/.*base64\,/g,'') åœ¨åŠ ç½‘ç»œè¯·æ±‚ä¼šå¡æ­» ä¸çŸ¥é“ä¸ºä»€ä¹ˆ
                if (_url[0] == ',') _url = _url.substr(1);
                // console.log(_url)
                if (localStorage.cnType == 'name') {
                    let val = window.inImgList[idx].name.replace(/\..*/, '');
                    cnInput.value = val;
                    window.configList[idx]['cn'] = val;
                    a({ currentTarget: { value: val}}, idx)
                } else if (localStorage.cnType == 'cv') {
                    getBdAcc(idx, (idx, acc)=>{
                        send2(idx, _url, (idx, result) => {
                            console.log(result)
                            if (result.result && result.result[0]) {
                                let val = result.result[0].keyword;
                                cnInput.value = val;
                                window.configList[idx]['cn'] = val;
                                console.log('idx a', idx)
                                a({ currentTarget: { value: val }}, idx)
                            }
                        })
                    })
                }
                console.log('over')
            }
        }
        var a = (ev, idx) => {
            if (idx == undefined) idx = window.tarIdx;
            if (idx == undefined) idx = window.imgList.length-1;
            setTimeout(() => {
                let val = ev.currentTarget.value;
                console.log('a', idx, val);
                window.configList[idx]['cn'] = val;
                showCnText(idx, val)
                // æ”¹ä¸­æ–‡çš„æ—¶å€™ æŸ¥ä¸€ä¸‹è‹±æ–‡æ˜¯ä»€ä¹ˆ
                send3(idx, val, (idx, result) => {
                    let enVal;
                    result = result.info;
                    if (result.translateResult && result.translateResult[0] && result.translateResult[0][0]) {
                        enVal = result.translateResult[0][0].tgt;
                    } else {
                        enVal = 'Find Nothing';
                    }
                    enInput.value = enVal;
                    window.configList[idx]['en'] = enVal;
                    b({ currentTarget: { value: enVal }}, idx)
                })
            }, 200)
        }
        function showCnText(idx, val) {
            const {
                _x,
                _y,
                _yy,
                fontSize1,
                fontSize2,
                font1Top,
                font2Top,
                font1Height,
                font2Height
            } = window.configList[idx];
            const ctx = window.ctxList[idx];
            let value = val;
            if (!value) return;
            let fontSize = fontSize1;
            ctx.font = `normal ${fontSize}px fzqy`;// normal æ”¹æˆ bold ä¼šé€ æˆå å½±
            ctx.fillStyle = 'white'
            //æ¨ªæ’æ–‡å­—
            ctx.fillRect(0, font1Top - fontSize1, _x, font1Height)
            console.log(0, font1Top, _x, font1Height)
            ctx.fillStyle = 'black'
            ctx.textAlign = 'center'
            ctx.fillText(value, _x / 2, font1Top);
            console.log(value, _x / 2, font1Top)
            addCardBg(ctx, idx)
            convertCanvasToImage(ctx.canvas, idx)
        }
        var b = (ev, idx) => {
            if (idx == undefined) idx = window.tarIdx;
            if (idx == undefined) idx = window.imgList.length-1;
            setTimeout(() => {
                let val = ev.currentTarget.value;
                window.configList[idx]['en'] = val;
                showEnText(idx, val)
                mixImg()
            }, 200)
        }
        function showEnText(idx, val) {
            const {
                _x,
                _y,
                _yy,
                fontSize1,
                fontSize2,
                font1Top,
                font2Top,
                font1Height,
                font2Height
            } = window.configList[idx];
            const ctx = window.ctxList[idx];
            let value = val;
            if (!value) return;
            let fontSize = fontSize2;
            ctx.font = `normal ${fontSize}px å¾®è½¯é›…é»‘`;
            ctx.fillStyle = 'white'
            //æ¨ªæ’æ–‡å­—
            ctx.fillRect(0, font2Top - fontSize2, _x, font2Height)
            ctx.fillStyle = 'black'
            ctx.textAlign = 'center'
            ctx.fillText(value, _x / 2, font2Top);
            addCardBg(ctx, idx)
            convertCanvasToImage(ctx.canvas, idx)
        }
        // $("#enInput").click(b);
        // $("#enInput").keydown(b);
        $("#enInput").keydown(b);
        $("#enInput").change(b);
        // $("#cnInput").click(a);
        // $("#cnInput").keydown(a);
        $("#cnInput").keydown(a);
        $("#cnInput").change(a);



        let lastX = 0;
        let lastY = 0;
        let isDown = false;
        let lastChangeTs = new Date().getTime()
        function startMove(ev) {
            ev.stopPropagation()
            console.log('start', ev)
            lastX = ev.offsetX;
            lastY = ev.offsetY;
            // if (ev.touches) lastX = ev.touches[0].pageX
            // if (ev.touches) lastY = ev.touches[0].pageY
            isDown = true;
            // ctx.drawImage(tarImg, x, y, tw, th, 0, 0, 708, 651);
            // addCardBg()
            // convertCanvasToImage(canvas)
            return false;
        }
        function onMove(ev) {
            return;
            ev.stopPropagation()
            // console.log('tw', tw, ' : ', 'th', th)
            // console.log('x', x, ' : ', 'y', y)
            // console.log('w', w, ' : ', 'h', h)
            if (isDown && (lastChangeTs < new Date().getTime() + 0.5 * 1000) && (ev.buttons != undefined ? (ev.buttons == 1 ? true : false) : true)) {
                lastChangeTs = new Date().getTime();
                console.log(ev.offsetX, lastX, ev.offsetX - lastX, ev.offsetY - lastY)
                _xd = ev.offsetX - lastX;
                _yd = ev.offsetY - lastY;
                console.log(_xd, _yd, '-----------------')
                // if (ev.touches) _xd = ev.touches[0].pageX - lastX
                // if (ev.touches) _yd = ev.touches[0].pageY - lastY
                if (tarImg) {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, _x, _y);
                    if (-_xd + x > w - tw) _xd = (x - w + tw);
                    if (-_xd + x < 0) _xd = x;
                    if (-_yd + y > h - th) _yd = (y - h + th);
                    if (-_yd + y < 0) _yd = y;
                    console.log(_xd, x, w, _x)
                    console.log(_xd + x + w, tw)
                    ctx.drawImage(tarImg, -_xd + x, -_yd + y, tw, th, 0, 0, _x, _y);
                    addCardBg(ctx, idx)
                    convertCanvasToImage(ctx.canvas, idx)
                }
            }
            return false;
        }
        function upMove(ev) {
            ev.stopPropagation()
            onMove(ev);
            console.log('up', ev)
            x = -_xd + x;
            y = -_yd + y;
            isDown = false;
            return false;
        }
        function getLen(str, halfSize = .5) {
            let len = 0
            console.log(str);
            for (let i = 0; i < str.length; i++) {
                const char = str[i];
                if (char.charCodeAt(0) < 256) {
                    len += halfSize
                } else {
                    len += 1
                }
            }
            console.log(str.length, len);
            return len;
        }
        let key = '#canvas-out';//'#pic-contrl';// #drag-contrl
        // åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒ
        function isPhone() {
            var u = navigator.userAgent;
            var app = navigator.appVersion;
            var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //androidç»ˆç«¯æˆ–è€…ucæµè§ˆå™¨ 
            var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //iosç»ˆç«¯ 
            if (isAndroid) {
                // æ˜¯ å®‰å“ç¯å¢ƒ
                return true
            } else if (isiOS) {
                // æ˜¯ ios ç¯å¢ƒ
                return true
            } else {
                var ua = window.navigator.userAgent.toLowerCase();
                if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                    return true; // æ˜¯å¾®ä¿¡ç«¯
                } else {
                    // ä¸æ˜¯æ‰‹æœºç«¯
                    return false;
                }
            }
        }
        if (!isPhone()) {
            $(key).mousedown(startMove);
            $(key).mousemove(onMove);
            $(key).mouseup(upMove);
        }
        // document.querySelector(key).addEventListener('touchstart', startMove);
        // document.querySelector(key).addEventListener('touchmove', onMove);
        // document.querySelector(key).addEventListener('touchend', upMove);
        // Converts image to canvas; returns new canvas element
        function convertImageToCanvas(image, ctx) {
            var canvas = ctx.canvas; //document.getElementById("img-transer");
            console.log(image)
            // canvas.width = image.width;
            // canvas.height = image.height;
            let tarWidth = image.naturalWidth
            let tarHeight = image.naturalHeight
            let lenLimit = 500;
            if (tarWidth > lenLimit) {
                tarHeight = tarHeight / tarWidth * lenLimit;
                tarWidth = lenLimit;
            }
            if (tarHeight > lenLimit) {
                tarWidth = tarWidth / tarHeight * lenLimit;
                tarHeight = lenLimit;
            }
            canvas.width = tarWidth;
            canvas.height = tarHeight;
            canvas.getContext("2d").drawImage(image, 0, 0, tarWidth, tarHeight);

            return canvas;
        }
        // Converts canvas to an image
        function convertCanvasToImage(canvas, idx) {
            console.log('convert')
            // var image = new Image();
            // image.src = canvas.toDataURL("image/png");
            // return image;
            var image = document.createElement('img');// document.getElementById('canvas-out')
            image.src = canvas.toDataURL("image/png");
            window.imgList = window.imgList || []
            window.imgList[idx] = image.src;
            return image;
        }

        function addCardBg(ctx, idx) {
            const {
                _x,
                _y,
                _yy,
                fontSize1,
                fontSize2,
                font1Top,
                font2Top,
                font1Height,
                font2Height
            } = window.configList[idx];
            ctx.drawImage(cardBgImg, 0, 0, _x, _yy);
        }

        function drawRoundedRect(rect, r, ctx) {
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2
            ctx.lineJoin = "round";
            var ptA = Point(rect.x + r, rect.y);
            var ptB = Point(rect.x + rect.width, rect.y);
            var ptC = Point(rect.x + rect.width, rect.y + rect.height);
            var ptD = Point(rect.x, rect.y + rect.height);
            var ptE = Point(rect.x, rect.y);

            ctx.beginPath();

            ctx.moveTo(ptA.x, ptA.y);
            ctx.arcTo(ptB.x, ptB.y, ptC.x, ptC.y, r);
            ctx.arcTo(ptC.x, ptC.y, ptD.x, ptD.y, r);
            ctx.arcTo(ptD.x, ptD.y, ptE.x, ptE.y, r);
            ctx.arcTo(ptE.x, ptE.y, ptA.x, ptA.y, r);

            ctx.stroke();
        }
        function getBdAcc(idx, cb) {
            if (window.baiduAcc) {
                cb(idx, window.baiduAcc);
                return;
            }
            const xhr = new XMLHttpRequest()
            xhr.onreadystatechange = function (ev) {
                console.log(ev)
                if (ev.currentTarget.readyState === 4) {
                    console.log(ev.currentTarget.response)
                    let acc = JSON.parse(ev.currentTarget.response).info;
                    window.baiduAcc = acc;
                    cb && cb(idx, acc)
                }
            }
            // https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=nRmvvyUB4chQ0OgvGaf6pSXw&client_secret=30vtCC8sf493bzZTcbrFckqWNc9quLfG
            xhr.open('GET', 'https://tekii.cn/market/baidu/getBdAcc')
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
            xhr.send() // è¿™é‡Œè¦åŠ encodeURIComponent å¦åˆ™ç™¾åº¦ä¼šformatå›¾ç‰‡å‡ºé”™
        }
        function send2(idx, base64, cb) {
            const xhr = new XMLHttpRequest()
            xhr.onreadystatechange = function (ev) {
                console.log(ev)
                if (ev.currentTarget.readyState === 4) {
                    console.log(ev.currentTarget.response)
                    cb && cb(idx, JSON.parse(ev.currentTarget.response))
                }
            }
            // https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=nRmvvyUB4chQ0OgvGaf6pSXw&client_secret=30vtCC8sf493bzZTcbrFckqWNc9quLfG
            xhr.open('POST', 'https://aip.baidubce.com/rest/2.0/image-classify/v2/advanced_general?idx=' + idx  + '&access_token=' + window.baiduAcc);//'https://tekii.cn/bd/img')
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
            xhr.send('image=' + encodeURIComponent(base64)) // è¿™é‡Œè¦åŠ encodeURIComponent å¦åˆ™ç™¾åº¦ä¼šformatå›¾ç‰‡å‡ºé”™
        }
        function send3(idx, cn, cb) {
            const xhr = new XMLHttpRequest()
            xhr.onreadystatechange = function (ev) {
                console.log(ev)
                if (ev.currentTarget.readyState === 4 && ev.currentTarget.status === 200) {
                    cb && cb(idx, JSON.parse(ev.currentTarget.response))
                }
            }
            // https://www.cnblogs.com/fanyang1/p/9414088.html
            // http://fanyi.youdao.com/translate?&doctype=json&type=AUTO&i=è®¡ç®—
            xhr.open('GET', '/market/q/trans?i=' + encodeURIComponent(cn))
            xhr.send()

        }
        function blobToDataURL(blob, cb) {
            let reader = new FileReader();
            reader.onload = function (evt) {
                var base64 = evt.target.result
                cb(base64)
            };
            reader.readAsDataURL(blob);
        }

        // var file = document.getElementById("file");
        function changeImg(imgFile, cb) {
            if (imgFile) {
                var url = URL.createObjectURL(imgFile);
                var base64 = blobToDataURL(imgFile, function (base64Url) {
                    // console.log(base64Url)
                    cb && cb(base64Url);
                })
            }
        }
        function getBase64(img, ctx) {
            // let imgTranser = document.getElementById('img-transer');
            // let ctx = imgTranser.getContext('2d');
            return convertImageToCanvas(img, ctx).toDataURL("image/png")
        }
        var canvasOut = document.getElementById('canvas-out')
        canvasOut.onclick = function(ev) {
            console.log(ev)
            let l = ev.offsetX;
            let t = ev.offsetY;
            let w = ev.target.width;
            let h = ev.target.height;
            let imageCount = window.imgList.length;
            let xIdx;
            let yIdx;
            if (imageCount < 4) {
                xIdx = (l * imageCount / w) | 0;
                yIdx = 0;
            } else {
                let imageHCount = Math.ceil(imageCount / 4);
                xIdx = (l * 4 / w) | 0;
                yIdx = (t * imageHCount / h) | 0;
            }
            console.log(xIdx, yIdx);
            selectImg(xIdx + yIdx * 4);
        }
        function selectImg(idx) {
            cnInput.value = window.configList[idx]['cn'] || '';
            enInput.value = window.configList[idx]['en'] || '';
            let file = window.inImgList[idx];
            window.tarIdx = idx;
            document.getElementById('topImg').src = window.URL.createObjectURL(file);
        }
    </script>

</body>

</html>